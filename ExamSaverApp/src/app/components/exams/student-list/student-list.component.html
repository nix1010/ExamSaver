<app-load-spinner *ngIf="showSpinner"></app-load-spinner>
<div *ngIf="errorMessage" class="banner-alert alert alert-danger fade show w-100 text-center">
    {{ errorMessage }}
</div>
<div *ngIf="similarityRunResult && similarityRunResult.runMessage"
    class="banner-alert alert alert-warning fade show w-100 text-center">
    {{ similarityRunResult.runMessage }}
</div>
<div class="container wrapper" *ngIf="showContent">
    <div class="row mt-5">
        <div class="col">
            <h4>{{ exam.subjectName }}</h4>
            <div class="date">
                {{ exam.startTime | date: DISPLAY_DATE_FORMAT }}
            </div>
            <div class="duration">
                {{ exam.startTime | date: DISPLAY_TIME_FORMAT }} - {{ exam.endTime | date: DISPLAY_TIME_FORMAT }}
            </div>
            <div class="similarity" *ngIf="examStudents.length > 1">
                <div class="similarity-check card mt-5">
                    <h5 class="mb-3">Similarity check</h5>
                    <form #form>
                        <div class="form-group mb-3">
                            <label for="fileExtension">File extension:</label>
                            <select class="form-select" id="fileExtension" name="fileExtension"
                                [(ngModel)]="similarityRequest.fileExtension" required>
                                <option *ngFor="let fileExtension of FILE_EXTENSIONS" [ngValue]="fileExtension">
                                    .{{ fileExtension }}
                                </option>
                            </select>
                            <div class="invalid-feedback">File extension must be provided</div>
                        </div>
                        <div class="form-group">
                            <label for="comment">Comment:</label>
                            <input type="text" id="comment" name="comment" class="form-control" placeholder="Optional"
                                [(ngModel)]="similarityRequest.comment" />
                        </div>
                        <div class="similarity-check-button mt-4">
                            <button class="btn btn-primary btn-sm" [disabled]="showSimilarityRunningSpinner"
                                (click)="performSimilarityCheck()">
                                Perform similarity check
                            </button>
                            <div class="similarity-check-spinner" *ngIf="showSimilarityRunningSpinner">
                                <app-load-spinner [size]="'small'"></app-load-spinner>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="mt-5" *ngIf="similarityResults.length > 0">
                    <h6>Similarity results
                        <small class="results-availability">
                            (Available for 14 days)
                        </small>
                        :
                    </h6>
                    <div class="list-group">
                        <div *ngFor="let similarityResult of similarityResults" class="list-group-item">
                            <app-similarity-result [examId]="examId" [similarityResult]="similarityResult"
                                (deleted)="deletedSimilarityResult()" (error)="errorMessage = $event">
                            </app-similarity-result>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col mt-4 students-list">
            <div *ngIf="examStudents.length > 0 else noStudents">
                <h6>Students:</h6>
                <div class="list-group">
                    <a *ngFor="let examStudent of examStudents"
                        [routerLink]="'/exams/holding/' + examStudent.examId + '/students/' + examStudent.studentId + '/tree'"
                        class="list-group-item list-group-item-action">
                        <div class="student">
                            <div class="name">
                                {{ examStudent.firstName }} {{ examStudent.lastName }}, {{ examStudent.index }}
                            </div>
                            <div class="submit-time" [title]="examStudent.uploadTime | date: DISPLAY_DATE_FORMAT">
                                {{ examStudent.uploadTime | date: DISPLAY_TIME_FORMAT }}
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            <ng-template #noStudents>
                <div class="no-content">
                    No students have submitted work for this exam
                </div>
            </ng-template>
        </div>
    </div>
</div>